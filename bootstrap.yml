---
- hosts: all
  sudo: yes
  gather_facts: false
  vars_files:
    - config.yml

  tasks:
  
    - name: Create user of Redmine installation
      user: name='{{ redmine_owner }}'
            ssh_key_file=.ssh/id_rsa

    - name: Set up authorized_keys for the redmine account
      authorized_key: user='{{ redmine_owner }}'
                      key="{{ redmine_owner_ssh_pub_key }}"

    - name: Set up sudoers for the redmnine account
      template: dest='/etc/sudoers.d/10_{{ redmine_owner }}'
                src=templates/sudoers.j2
                owner=root
                mode=0440

